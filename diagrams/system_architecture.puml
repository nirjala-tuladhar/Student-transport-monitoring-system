@startuml System_Architecture
skinparam linetype ortho
skinparam backgroundColor #FEFEFE
skinparam componentBackgroundColor #E6F7FF
skinparam componentBorderColor #1E90FF
skinparam packageBackgroundColor #F0F0F0

title Student Transport Monitoring System - System Architecture

package "Client Applications" {
  [Super Admin Panel] as SuperAdmin
  [School Admin Panel] as SchoolAdmin
  [Parent Panel] as Parent
  [Bus Driver Panel] as Bus
}

package "Authentication Layer" {
  [Auth Service] as Auth
  [Supabase Auth] as SupabaseAuth
}

package "Business Logic Layer" {
  [School Service] as SchoolSvc
  [Parent Service] as ParentSvc
  [Bus Service] as BusSvc
  [Notification Service] as NotifSvc
  [Geocoding Service] as GeoSvc
}

package "Data Layer" {
  database "Supabase PostgreSQL" as DB {
    [schools]
    [users]
    [school_admins]
    [buses]
    [students]
    [parents]
    [bus_locations]
    [student_boarding_status]
    [notifications]
  }
}

package "Real-time Layer" {
  [Supabase Realtime] as Realtime
  [Location Updates Channel] as LocChannel
  [Boarding Status Channel] as BoardChannel
}

package "External Services" {
  [OpenStreetMap API] as OSM
  [Nominatim Geocoding] as Nominatim
}

' Client to Auth
SuperAdmin --> Auth
SchoolAdmin --> Auth
Parent --> Auth
Bus --> Auth

Auth --> SupabaseAuth

' Client to Services
SuperAdmin --> SchoolSvc
SchoolAdmin --> SchoolSvc
Parent --> ParentSvc
Bus --> BusSvc

SchoolAdmin --> NotifSvc
Parent --> NotifSvc
Bus --> NotifSvc

Parent --> GeoSvc
SchoolAdmin --> GeoSvc

' Services to Database
SchoolSvc --> DB
ParentSvc --> DB
BusSvc --> DB
NotifSvc --> DB

' Services to External
GeoSvc --> Nominatim

' Real-time connections
Bus --> Realtime : Publish location
Parent --> Realtime : Subscribe to updates
SchoolAdmin --> Realtime : Subscribe to updates

Realtime --> LocChannel
Realtime --> BoardChannel

LocChannel --> DB : Store location
BoardChannel --> DB : Store status

' Map display
Parent --> OSM : Load map tiles
SchoolAdmin --> OSM : Load map tiles
Bus --> OSM : Load map tiles

note right of SuperAdmin
  - Create school admins
  - Manage schools
  - System overview
end note

note right of SchoolAdmin
  - Manage buses
  - Manage students
  - View real-time locations
  - Track attendance
end note

note right of Parent
  - Track child's bus
  - View notifications
  - Edit bus stop location
  - Real-time updates
end note

note right of Bus
  - Update GPS location
  - Mark boarding status
  - View assigned students
  - Navigate route
end note

note bottom of DB
  Row Level Security (RLS)
  policies enforce access
  control per user role
end note

note bottom of Realtime
  WebSocket connections
  for live location and
  status updates
end note

@enduml
